import*as e from"react";import t,{localeOption as n}from"primereact/api";import{Button as o}from"primereact/button";import{useOverlayListener as r,useMountEffect as l,useUpdateEffect as i,useUnmountEffect as a}from"primereact/hooks";import{InputText as u}from"primereact/inputtext";import{OverlayService as c}from"primereact/overlayservice";import{Tooltip as p}from"primereact/tooltip";import{classNames as s,ObjectUtils as m,UniqueComponentId as f,DomHandler as d,ZIndexUtils as g,IconUtils as v}from"primereact/utils";import{CSSTransition as y}from"primereact/csstransition";import{Portal as h}from"primereact/portal";import{Ripple as b}from"primereact/ripple";import{VirtualScroller as E}from"primereact/virtualscroller";function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},C.apply(this,arguments)}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function S(e){if(Array.isArray(e))return w(e)}function O(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function x(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e){if(Array.isArray(e))return e}function N(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=l.call(n)).done)&&(a.push(o.value),a.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw r}}return a}}function D(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){return I(e)||N(e,t)||x(e,t)||D()}function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function j(e,t){if("object"!==P(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==P(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function M(e){var t=j(e,"string");return"symbol"===P(t)?t:String(t)}function F(e,t,n){return(t=M(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=e.memo(e.forwardRef((function(t,o){var r,l,i,a=function(e){return m.resolveFieldData(e,t.optionGroupLabel)},u=function(n,o,r){return t.getOptionGroupChildren(n).map((function(n,l){var i=o+"_"+l,a=t.selectedItem===n,u=t.itemTemplate?m.getJSXElement(t.itemTemplate,n,l):t.field?m.resolveFieldData(n,t.field):n;return e.createElement("li",{key:i,role:"option","aria-selected":a,className:"p-autocomplete-item",style:r,onClick:function(e){return t.onItemClick(e,n)},"data-group":o,"data-index":l},u,e.createElement(b,null))}))},c=function(n,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l={height:r.props?r.props.itemSize:void 0};if(t.optionGroupLabel){var i=t.optionGroupTemplate?m.getJSXElement(t.optionGroupTemplate,n,o):t.getOptionGroupLabel(n),c=u(n,o,l),p=o+"_"+a(n);return e.createElement(e.Fragment,{key:p},e.createElement("li",{className:"p-autocomplete-item-group",style:l},i),c)}var s=t.itemTemplate?m.getJSXElement(t.itemTemplate,n,o):t.field?m.resolveFieldData(n,t.field):n;return e.createElement("li",{key:o,role:"option","aria-selected":t.selectedItem===n,className:"p-autocomplete-item",style:l,onClick:function(e){return t.onItemClick(e,n)}},s,e.createElement(b,null))},p=function(){if(t.showEmptyMessage&&m.isEmpty(t.suggestions)){var o=t.emptyMessage||n("emptyMessage");return e.createElement("ul",{className:"p-autocomplete-items"},e.createElement("li",{className:"p-autocomplete-item"},o))}if(t.virtualScrollerOptions){var r=R(R({},t.virtualScrollerOptions),{style:R(R({},t.virtualScrollerOptions.style),{height:t.scrollHeight}),autoSize:!0,items:t.suggestions,itemTemplate:function(e,t){return e&&c(e,t.index,t)},contentTemplate:function(n){var o=s("p-autocomplete-items",n.className);return e.createElement("ul",{ref:n.contentRef,className:o,role:"listbox",id:t.listId},n.children)}});return e.createElement(E,C({ref:t.virtualScrollerRef},r))}var l=t.suggestions?t.suggestions.map(c):null;return e.createElement("ul",{className:"p-autocomplete-items",role:"listbox",id:t.listId},l)},f=(r=s("p-autocomplete-panel p-component",t.panelClassName),l=R({maxHeight:t.scrollHeight},t.panelStyle||{}),i=p(),e.createElement(y,{nodeRef:o,classNames:"p-connected-overlay",in:t.in,timeout:{enter:120,exit:100},options:t.transitionOptions,unmountOnExit:!0,onEnter:t.onEnter,onEntering:t.onEntering,onEntered:t.onEntered,onExit:t.onExit,onExited:t.onExited},e.createElement("div",{ref:o,className:r,style:l,onClick:t.onClick},i)));return e.createElement(h,{element:f,appendTo:t.appendTo})})));A.displayName="AutoCompletePanel";var G=e.memo(e.forwardRef((function(y,h){var b=T(e.useState(y.id),2),E=b[0],w=b[1],I=T(e.useState(!1),2),N=I[0],D=I[1],P=T(e.useState(!1),2),j=P[0],M=P[1],F=T(e.useState(!1),2),L=F[0],R=F[1],K=e.useRef(null),U=e.useRef(null),H=e.useRef(y.inputRef),_=e.useRef(null),z=e.useRef(null),B=e.useRef(null),J=e.useRef(null),X=T(r({target:K,overlay:U,listener:function(e,t){t.valid&&("outside"===t.type?!Y(e)&&oe():oe())},when:L}),2),q=X[0],V=X[1],Y=function(e){return y.multiple?e.target===_.current||_.current.contains(e.target):e.target===H.current},Z=function(e){B.current&&clearTimeout(B.current);var t=e.target.value;y.multiple||W(e,t),m.isEmpty(t)?(oe(),y.onClear&&y.onClear(e)):t.length>=y.minLength?B.current=setTimeout((function(){$(e,t,"input")}),y.delay):oe()},$=function(e,t,n){null!=t&&("input"===n&&0===t.trim().length||y.completeMethod&&(D(!0),y.completeMethod({originalEvent:e,query:t})))},Q=function(e,t,n){if(y.multiple){if(H.current.value="",!ye(t)&&(!y.value||!y.selectionLimit||y.value.length<y.selectionLimit)){var o=y.value?[].concat(S(r=y.value)||O(r)||x(r)||k(),[t]):[t];W(e,o)}}else te(t),W(e,t);var r;y.onSelect&&y.onSelect({originalEvent:e,value:t}),n||(d.focus(H.current),oe())},W=function(e,t){J&&m.deepEquals(J.current,t)||(y.onChange&&y.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:y.name,id:E,value:t}}),J.current=t)},ee=function(e){if(e){if("string"==typeof e)return e;if(y.selectedItemTemplate){var t=m.getJSXElement(y.selectedItemTemplate,e);return t||e}if(y.field){var n=m.resolveFieldData(e,y.field);return null!=n?n:e}return e}return""},te=function(e){H.current.value=ee(e)},ne=function(){R(!0)},oe=function(){R(!1),D(!1)},re=function(){d.alignOverlay(U.current,y.multiple?_.current:H.current,y.appendTo||t.appendTo)},le=function(e){y.dropdownAutoFocus&&d.focus(H.current,y.dropdownAutoFocus),"blank"===y.dropdownMode?$(e,"","dropdown"):"current"===y.dropdownMode&&$(e,H.current.value,"dropdown"),y.onDropdownClick&&y.onDropdownClick({originalEvent:e,query:H.current.value})},ie=function(e,t){var n=y.value[t],o=y.value.filter((function(e,n){return t!==n}));W(e,o),y.onUnselect&&y.onUnselect({originalEvent:e,value:n})},ae=function(e){if(L){var t=d.findSingle(U.current,"li.p-highlight");switch(e.which){case 40:if(t){var n=ce(t);n&&(d.addClass(n,"p-highlight"),d.removeClass(t,"p-highlight"),d.scrollInView(he(),n))}else t=d.findSingle(U.current,"li"),d.hasClass(t,"p-autocomplete-item-group")&&(t=ce(t)),t&&d.addClass(t,"p-highlight");e.preventDefault();break;case 38:if(t){var o=pe(t);o&&(d.addClass(o,"p-highlight"),d.removeClass(t,"p-highlight"),d.scrollInView(he(),o))}e.preventDefault();break;case 13:t&&(ue(e,t),oe(),e.preventDefault());break;case 27:oe(),e.preventDefault();break;case 9:t&&ue(e,t),oe()}}if(y.multiple&&8===e.which)if(y.value&&y.value.length&&!H.current.value){var r=y.value[y.value.length-1],l=y.value.slice(0,-1);W(e,l),y.onUnselect&&y.onUnselect({originalEvent:e,value:r})}},ue=function(e,t){y.optionGroupLabel?Q(e,be(y.suggestions[t.dataset.group])[t.dataset.index]):Q(e,y.suggestions[d.index(t)])},ce=function e(t){var n=t.nextElementSibling;return n?d.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},pe=function e(t){var n=t.previousElementSibling;return n?d.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},se=function(e){M(!0),y.onFocus&&y.onFocus(e)},me=function(e){var t=e.target.value.trim(),n=(y.suggestions||[]).find((function(e){var n=y.field?m.resolveFieldData(e,y.field):e;return n&&t===n.trim()}));n?Q(e,n,!0):(H.current.value="",W(e,null),y.onClear&&y.onClear(e))},fe=function(e){M(!1),y.forceSelection&&me(e),y.onBlur&&y.onBlur(e)},de=function(e){d.focus(H.current),y.onClick&&y.onClick(e)},ge=function(e){se(e),d.addClass(_.current,"p-focus")},ve=function(e){fe(e),d.removeClass(_.current,"p-focus")},ye=function(e){return!!y.value&&y.value.some((function(t){return m.equals(t,e)}))},he=function(){return z.current?U.current.firstChild:U.current},be=function(e){return m.resolveFieldData(e,y.optionGroupChildren)};e.useEffect((function(){m.combinedRefs(H,y.inputRef)}),[H,y.inputRef]),l((function(){E||w(f()),y.autoFocus&&d.focus(H.current,y.autoFocus)})),i((function(){N&&(m.isNotEmpty(y.suggestions)||y.showEmptyMessage?ne():oe(),D(!1))}),[y.suggestions]),i((function(){H.current&&!y.multiple&&te(y.value)})),a((function(){B.current&&clearTimeout(B.current),g.clear(U.current)})),e.useImperativeHandle(h,(function(){return{props:y,search:$,show:ne,hide:oe,getElement:function(){return K.current},getOverlay:function(){return U.current},getInput:function(){return H.current},getVirtualScroller:function(){return z.current}}}));var Ee=function(){var t=ee(y.value),n=L?E+"_list":null,o=s("p-autocomplete-input",y.inputClassName,{"p-autocomplete-dd-input":y.dropdown});return e.createElement(u,C({ref:H,id:y.inputId,type:y.type,name:y.name,defaultValue:t,role:"combobox","aria-autocomplete":"list","aria-controls":n,"aria-haspopup":"listbox","aria-expanded":L,className:o,style:y.inputStyle,autoComplete:"off",readOnly:y.readOnly,disabled:y.disabled,placeholder:y.placeholder,size:y.size,maxLength:y.maxLength,tabIndex:y.tabIndex,onBlur:fe,onFocus:se,onChange:Z,onMouseDown:y.onMouseDown,onKeyUp:y.onKeyUp,onKeyDown:ae,onKeyPress:y.onKeyPress,onContextMenu:y.onContextMenu,onClick:y.onClick,onDoubleClick:y.onDblClick},xe))},Ce=function(){var t=s("p-autocomplete-multiple-container p-component p-inputtext",{"p-disabled":y.disabled}),n=m.isNotEmpty(y.value)?y.value.map((function(t,n){return e.createElement("li",{key:n+"multi-item",className:"p-autocomplete-token p-highlight"},e.createElement("span",{className:"p-autocomplete-token-label"},ee(t)),!y.disabled&&v.getJSXIcon(y.removeIcon,{className:"p-autocomplete-token-icon",onClick:function(e){return ie(e,n)}},{props:y}))})):null,o=e.createElement("li",{className:"p-autocomplete-input-token"},e.createElement("input",C({ref:H,type:y.type,disabled:y.disabled,placeholder:y.placeholder,role:"combobox","aria-autocomplete":"list","aria-controls":L?E+"_list":null,"aria-haspopup":"listbox","aria-expanded":L,autoComplete:"off",readOnly:y.readOnly,tabIndex:y.tabIndex,onChange:Z,id:y.inputId,name:y.name,style:y.inputStyle,className:y.inputClassName,maxLength:y.maxLength,onKeyUp:y.onKeyUp,onKeyDown:ae,onKeyPress:y.onKeyPress,onFocus:ge,onBlur:ve},xe)));return e.createElement("ul",{ref:_,className:t,onContextMenu:y.onContextMenu,onMouseDown:y.onMouseDown,onClick:de,onDoubleClick:y.onDblClick},n,o)},we=E+"_list",Se=m.isNotEmpty(y.tooltip),Oe=m.findDiffKeys(y,G.defaultProps),xe=m.reduceKeys(Oe,d.ARIA_PROPS),ke=s("p-autocomplete p-component p-inputwrapper",{"p-autocomplete-dd":y.dropdown,"p-autocomplete-multiple":y.multiple,"p-inputwrapper-filled":y.value,"p-inputwrapper-focus":j},y.className),Ie=N?e.createElement("i",{className:"p-autocomplete-loader pi pi-spinner pi-spin"}):null,Ne=y.multiple?Ce():Ee(),De=function(){if(y.dropdown){var t=y.dropdownAriaLabel||y.placeholder||n("choose");return e.createElement(o,{type:"button",icon:y.dropdownIcon,className:"p-autocomplete-dropdown",disabled:y.disabled,onClick:le,"aria-label":t})}return null}();return e.createElement(e.Fragment,null,e.createElement("span",C({ref:K,id:E,style:y.style,className:ke},Oe),Ne,Ie,De,e.createElement(A,C({ref:U,virtualScrollerRef:z},y,{listId:we,onItemClick:Q,selectedItem:J,onClick:function(e){c.emit("overlay-click",{originalEvent:e,target:K.current})},getOptionGroupLabel:function(e){return y.optionGroupLabel?m.resolveFieldData(e,y.optionGroupLabel):e},getOptionGroupChildren:be,in:L,onEnter:function(){g.set("overlay",U.current,t.autoZIndex,t.zIndex.overlay),re()},onEntering:function(){if(y.autoHighlight&&y.suggestions&&y.suggestions.length){var e=he().firstChild.firstChild;d.addClass(e,"p-highlight")}},onEntered:function(){q(),y.onShow&&y.onShow()},onExit:function(){V()},onExited:function(){g.clear(U.current),y.onHide&&y.onHide()}}))),Se&&e.createElement(p,C({target:K,content:y.tooltip},y.tooltipOptions)))})));G.displayName="AutoComplete",G.defaultProps={__TYPE:"AutoComplete",id:null,appendTo:null,autoFocus:!1,autoHighlight:!1,className:null,completeMethod:null,delay:300,disabled:!1,dropdown:!1,dropdownAriaLabel:null,dropdownAutoFocus:!0,dropdownIcon:"pi pi-chevron-down",dropdownMode:"blank",emptyMessage:null,field:null,forceSelection:!1,inputClassName:null,inputId:null,inputRef:null,inputStyle:null,itemTemplate:null,maxLength:null,minLength:1,multiple:!1,name:null,onBlur:null,onChange:null,onClear:null,onClick:null,onContextMenu:null,onDblClick:null,onDropdownClick:null,onFocus:null,onHide:null,onKeyPress:null,onKeyUp:null,onMouseDown:null,onSelect:null,onShow:null,onUnselect:null,optionGroupChildren:null,optionGroupLabel:null,optionGroupTemplate:null,panelClassName:null,panelStyle:null,placeholder:null,readOnly:!1,removeIcon:"pi pi-times-circle",scrollHeight:"200px",selectedItemTemplate:null,selectionLimit:null,showEmptyMessage:!1,size:null,style:null,suggestions:null,tabIndex:null,tooltip:null,tooltipOptions:null,transitionOptions:null,type:"text",value:null,virtualScrollerOptions:null};export{G as AutoComplete};
