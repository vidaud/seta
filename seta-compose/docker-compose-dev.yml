version: "3.8"
services:
  seta-mongo:
    container_name: seta-mongo
    restart: always
    build: ../seta-mongo
    expose:
      - "27017"
    networks: 
      - seta-network
    volumes: 
      - seta-mongo:/data/db
  seta-es:
    container_name: seta-es
    restart: always
    build: ../seta-es
    expose:
      - "9200"
      - "9300"
    mem_limit: "6g"
    volumes: 
      - seta-es2:/usr/share/elasticsearch/data
    networks: 
      - seta-network
    environment:
      - xpack.security.enabled=false
      - discovery.type=single-node
      - xpack.security.http.ssl.enabled=false
      - xpack.security.transport.ssl.enabled=false


  seta-api:
    container_name: seta-api
    restart: always
    build:
      context: ../seta-api
      dockerfile: Dockerfile-dev-flask
    expose:
      - "8081"
    mem_limit: "8g"
    volumes: 
      - ../seta-api:/home/seta
      - seta-models2:/home/seta/models
    networks: 
      - seta-network
    depends_on:
      - "seta-mongo"
      - "seta-es"

  seta-nginx:
    container_name: seta-nginx
    restart: always
    build: ../seta-nginx
    ports:
      - "80:80"
    depends_on:
      - "seta-api"
      - "seta-ui"
    networks: 
      - seta-network

  seta-ui:
    container_name: seta-ui
    restart: always
    build: 
       context: ../seta-ui
       dockerfile: Dockerfile-dev-flask
    depends_on:
      - "seta-api"
    expose:
      - "8080"
    volumes: 
      - ../seta-ui:/home/seta/
      - seta-models2:/home/seta/models
    networks: 
      - seta-network

  seta-ui-spa:
    container_name: seta-ui-spa
    restart: always
    build: 
       context: ../seta-ui
       dockerfile: Dockerfile-dev-spa
    depends_on:
      - "seta-api"
    expose:
      - "8080"
    volumes: 
      - ../seta-ui:/home/seta/
    networks: 
      - seta-network



networks:
  seta-network:
    name: seta-network
    driver: bridge

volumes:
  seta-mongo:
  seta-es2:
  seta-models2:
